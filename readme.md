# Biocomputing with Brainoware - Code Repository

This repository contains the code implementation for the Brainoware.

## Overview
This GITHUB code repository provides code and resources related to Brainoware's hardware properties and software framework as described in the associated Nature Protocols paper submission.

## Contents
- Procedure 2
    -  evoked response
        - evoked_response_MEA.py [**maxlab environment**]
        - psth_plot. [**analysis environment**]
        - psth_exp_spike.csv [**required raw file for analysis**]
        - psth_exp_sti_time.csv [**required raw file for analysis**]
        - result plots and files generated by psth_plot.py
    - recurrent effects
        - recurrent_effects_MEA.py [**maxlab environment**]
    - spatial information
        - spatial_information.py [**maxlab environment**]
    - stimulation_example_official.py [**maxlab environment**]
- Procedure 3
    - 1_information_encoding.ipynb [**analysis environment**]
    - 2_Electrical_stimulation_and_recording.py [**maxlab environment**]
    - 2_Electrical_stimulation_and_recording_data [**required raw recording file**]

        *.raw.h5 [download [here](https://www.dropbox.com/scl/fi/2m520ce9z6iqisdgyrknr/speech_recognition_10hz_75mv_21680.raw.h5?rlkey=lfzxqpb2n848qpx6ts7jlzwfc&st=0pdrt5yv&dl=0) and save under this directory]
    - 3_Information_decoding.ipynb [**analysis environment**]
    - 4_Readout_layer_training_and_prediction.ipynb [**analysis environment**]
    - related datasets and result files
## Getting Started

In this protocol, two Python environments are required to finish all steps:
- maxlab environment

    Global Python environment on the PC that connects to the MaxOne High-Density Microelectrode Array (HD-MEA) System. This environment requires *maxlab*, a Python MEA stimulation library developed by MaxWell biosystems, pre-installed in the system Python package directory (…/python3.8/site-packages/maxlab) to enable electrical stimulation on the MaxOne MEA recording unit through a Python script. Ask [MaxWell biosystems](https://www.mxwbio.com/) for help with maxlab environment setup (info@mxwbio.com)

    In this repository, we have provided raw data resources so that you can still run through all analysis steps without dealing with maxlab environment. For the huge raw recording file, download it to the required directory by following the instructions in the [Contents](#contents) part. 

- analysis environment

    Conda-based Python virtual environment for data analysis. This can be set up in any device with conda installed (See conda webpage for detailed installation guide: https://docs.conda.io/projects/conda/en/latest/index.html)

    After conda is installed:
    1. Download or clone this repository
    2. Open the Anaconda prompt and change directory to this repository
    3. Add conda-forge channel
        ```bash
        conda config --add channels conda-forge
        ```
        **for MacOS user, also run this line:**
        ```bash
        conda config --env --set subdir osx-64
        # In macOS, Conda no longer builds or keeps Python 3.7 because it’s end-of-life. When you run this line, you force Conda to use the older Intel macOS (osx-64) repository, where Python 3.7 packages still exist, so the installation succeeds even though it’s effectively using a legacy platform.
        ```
    4. Create a new virtual environment using the provided environment.yml file in the root of the repository 
    **[Don't forget to change the directory to this repository!]**
        ```bash
        conda env create --name brainoware_analysis -f environment.yml
        ``` 
    5. Activate the created analysis environment
        ```bash
        conda activate brainoware_analysis
        ```
    6. Manually install spykes [credits: [KordingLab](https://github.com/KordingLab/spykes)]
        ```bash
        pip install -e spykes-master
        ```
    7. Install jupyter notebook, ipykernel, and register the kernel in the jupyter notebook
        ```bash
        pip install notebook
        pip install ipykernel
        python -m ipykernel install --user --name=brainoware_analysis --display-name "Python (brainoware_analysis)"
        ```
    8. For files with *.py suffix, run
        ```bash
        python *.py
        ```
        e.g. procedure_2/1_evoked_response/psth_plot.py
    9. For files with *.ipynb suffix, run
        ```bash
        jupyter notebook *.ipynb
        ```
        e.g. procedure_3/1_Information_encoding.ipynb
        
        After entering the notebook page, select brainoware_analysis kernel in the upper right corner of the page (or in the navigation bar -  kernel - change kernel) and run the code one block by one block.
    10. Execution order of analysis environment
        - procedure_2/1_evoked_response/psth_plot.py
        - procedure_3/1_Information_encoding.ipynb
        - procedure_3/3_Information_decoding.ipynb
        - procedure_3/4_Readout_layer_training_and_prediction.ipynb

## Citation
If you're using this repository in your research, please cite the associated Nature Protocols article.

## License
See LICENSE file for details.
